# Deployment & Testing Feedback Report: game-localization-mvr

## 1. Executive Summary

This report documents issues encountered during the initial setup, deployment, and testing of the `game-localization-mvr` repository on a Windows environment. The primary issues relate to **cross-platform encoding compatibility**, **test data integrity**, and **test suite self-containment**.

Addressing these issues will significantly improve the "out-of-the-box" experience for new developers and ensure CI/CD reliability.

## 2. Critical Issues

### 2.1. Windows Encoding Incompatibility (Unicode/Emoji Handling)
**Severity**: üî¥ Critical
**Context**: Windows terminals and file systems often default to `cp1252` or `gbk`, while the project relies heavily on emojis (‚úÖ, ‚ùå) and UTF-8 characters.

*   **Issue 1: Subprocess Output Capture**
    *   **File**: `scripts/test_e2e_workflow.py`
    *   **Error**: `UnicodeDecodeError` or `UnicodeEncodeError` when capturing `stdout/stderr` from subprocesses containing emojis.
    *   **Fix**: Explicitly set `encoding='utf-8'` in `subprocess.run()`.
*   **Issue 2: CSV BOM Handling**
    *   **File**: `scripts/test_normalize.py`, `scripts/test_rehydrate.py`
    *   **Error**: `KeyError: 'string_id'` when reading CSV files created by Python's `csv` module on Windows if not handled consistently.
    *   **Fix**: Use `encoding='utf-8-sig'` to handle the Byte Order Mark (BOM) correctly, or enforce strict `utf-8` without BOM generation across all scripts.

### 2.2. End-to-End Test Data Consistency
**Severity**: üü† High
**Context**: `test_e2e_workflow.py` simulates a full workflow but uses mismatched input/output files.

*   **Problem**: The test script used `data/input.csv` (production data, ~500 rows) as input, but validated against `data/translated_good.csv` (sample data, ~7 rows) during the rehydration step.
*   **Consequence**: `rehydrate_export.py` failed because the `placeholder_map` generated from `input.csv` did not contain the tokens present in `translated_good.csv`.
*   **Recommendation**: The E2E test should be **self-contained**. It should generate its own `input_test.csv` and `translated_test.csv` with matching data, rather than mixing production inputs with sample validation files.

### 2.3. Unit Test Fragility
**Severity**: üü° Medium
**Context**: `test_normalize.py` and `test_rehydrate.py` contained hardcoded expectations that were brittle.

*   **Problem 1**: `test_normalize.py` expected exactly 11 placeholders. However, depending on the `input.csv` content (which varies), this number changes. Tests should rely on stable, dedicated test fixtures, not mutable production data.
*   **Problem 2**: `test_rehydrate.py` relies on `data/translated_bad.csv` to exist and contain specific errors. This file is not generated by the repo or the test script itself, leading to immediate failure if the user hasn't manually created "bad" data.

## 3. Documentation & Configuration Gaps

*   **`.gitignore` Blocking Test Data**: The `.gitignore` file was too aggressive, blocking `data/*_e2e.csv`. This prevented the creation of persistent test fixtures needed for reliable debugging.
*   **Missing "Bad" Data Fixtures**: The repository provides `translated.csv` (implied good), but lacks a `translated_bad.csv` fixture. Test scripts reference it, but it's not present, causing confusion.

## 4. Recommendations for Developers

1.  **Enforce UTF-8 Everywhere**: Update all `open()` calls and `subprocess.run()` calls to explicitly use `encoding='utf-8'` (or `utf-8-sig` for Excel compatibility) to support Windows users.
2.  **Containerize Tests**:
    *   Refactor `test_e2e_workflow.py` to generate temporary input CSVs programmatically at runtime rather than relying on `data/input.csv`.
    *   Ensure input and translated test files are 1:1 synchronized in terms of string IDs and tokens.
3.  **Provide Complete Test Fixtures**:
    *   Include `data/fixtures/` directory with `input_valid.csv`, `translated_valid.csv`, and `translated_invalid.csv`.
    *   Update tests to read from `fixtures/` instead of `data/`.
4.  **Update Gitignore**: Allow specific test artifact patterns (e.g., `test_*.csv`) or move test outputs to a `temp/` directory that is wholly ignored.

## 5. Sample Fix Code (Python)

```python
# In scripts/test_e2e_workflow.py

# BEFORE
result = subprocess.run(cmd, capture_output=True, text=True)

# AFTER
result = subprocess.run(cmd, capture_output=True, text=True, encoding='utf-8')
```
